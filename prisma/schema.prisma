generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Product {
  id                   String              @id @default(cuid())
  organizationId       String
  name                 String
  description          String?
  sku                  String
  barcode              String?
  categoryId           String?
  unitOfMeasure        String              @default("Each")
  costPrice            Decimal             @db.Decimal(10, 2)
  sellingPrice         Decimal             @db.Decimal(10, 2)
  taxRate              Decimal             @default(0) @db.Decimal(5, 2)
  imageUrl             String?
  status               ProductStatus       @default(ACTIVE)
  hasVariants          Boolean             @default(false)
  reorderPoint         Decimal             @default(0) @db.Decimal(10, 2)
  reorderQuantity      Decimal             @default(0) @db.Decimal(10, 2)
  trackExpiration      Boolean             @default(false)
  defaultShelfLifeDays Int?
  expiryAlertDays      Int                 @default(30)
  metadata             Json?
  createdAt            DateTime            @default(now())
  updatedAt            DateTime
  Category             Category?           @relation(fields: [categoryId], references: [id])
  Organization         Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  ProductVariant       ProductVariant[]
  PurchaseOrderItem    PurchaseOrderItem[]
  ReturnItem           ReturnItem[]
  sales                SaleItem[]
  StockAlert           StockAlert[]
  StockLevel           StockLevel[]
  StockTransferItem    StockTransferItem[]
  SupplierProduct      SupplierProduct[]

  @@unique([organizationId, barcode])
  @@unique([organizationId, sku])
  @@index([categoryId])
  @@index([organizationId])
  @@index([status])
}

model Sale {
  id                String              @id @default(cuid())
  saleNumber        String              @unique
  locationId        String
  customerId        String?
  userId            String
  status            SaleStatus          @default(PENDING)
  paymentType       SalePaymentType     @default(CASH)
  paymentMethod     PaymentMethod       @default(CASH)
  subtotal          Decimal             @default(0) @db.Decimal(12, 2)
  discountAmount    Decimal             @default(0) @db.Decimal(10, 2)
  taxAmount         Decimal             @default(0) @db.Decimal(10, 2)
  totalAmount       Decimal             @default(0) @db.Decimal(12, 2)
  amountPaid        Decimal             @default(0) @db.Decimal(12, 2)
  creditAmount      Decimal             @default(0) @db.Decimal(12, 2)
  changeGiven       Decimal             @default(0) @db.Decimal(10, 2)
  dueDate           DateTime?
  notes             String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  CreditTransaction CreditTransaction[]
  Invoice           Invoice[]
  Return            Return[]
  Customer          Customer?           @relation(fields: [customerId], references: [id])
  Location          Location            @relation(fields: [locationId], references: [id])
  User              User                @relation(fields: [userId], references: [id])
  items             SaleItem[]

  @@index([createdAt])
  @@index([customerId])
  @@index([locationId])
  @@index([paymentType])
  @@index([status])
  @@index([userId])
}

model SaleItem {
  id             String          @id @default(cuid())
  saleId         String
  productId      String
  variantId      String?
  quantity       Decimal         @db.Decimal(10, 2)
  unitPrice      Decimal         @db.Decimal(10, 2)
  discountAmount Decimal         @default(0) @db.Decimal(10, 2)
  taxAmount      Decimal         @default(0) @db.Decimal(10, 2)
  totalAmount    Decimal         @db.Decimal(12, 2)
  notes          String?
  costPrice      Decimal         @default(0) @db.Decimal(12, 2)
  ReturnItem     ReturnItem[]
  product        Product         @relation(fields: [productId], references: [id])
  sale           Sale            @relation(fields: [saleId], references: [id], onDelete: Cascade)
  ProductVariant ProductVariant? @relation(fields: [variantId], references: [id])

  @@index([productId])
  @@index([saleId])
}

model AuditLog {
  id         String   @id
  userId     String?
  action     String
  entityType String
  entityId   String
  entityName String?
  changes    Json?
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime @default(now())
  User       User?    @relation(fields: [userId], references: [id])

  @@index([createdAt])
  @@index([entityId])
  @@index([entityType])
  @@index([userId])
}

model CashDrawer {
  id                               String            @id
  organizationId                   String
  locationId                       String
  name                             String
  status                           CashDrawerStatus  @default(CLOSED)
  currentBalance                   Decimal           @default(0) @db.Decimal(12, 2)
  openedAt                         DateTime?
  openedById                       String?
  closedAt                         DateTime?
  closedById                       String?
  startingFloat                    Decimal?          @db.Decimal(12, 2)
  expectedBalance                  Decimal?          @db.Decimal(12, 2)
  actualBalance                    Decimal?          @db.Decimal(12, 2)
  discrepancy                      Decimal?          @db.Decimal(12, 2)
  notes                            String?
  createdAt                        DateTime          @default(now())
  updatedAt                        DateTime
  User_CashDrawer_closedByIdToUser User?             @relation("CashDrawer_closedByIdToUser", fields: [closedById], references: [id])
  Location                         Location          @relation(fields: [locationId], references: [id])
  User_CashDrawer_openedByIdToUser User?             @relation("CashDrawer_openedByIdToUser", fields: [openedById], references: [id])
  Organization                     Organization      @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  CashTransaction                  CashTransaction[]

  @@index([locationId])
  @@index([status])
}

model CashTransaction {
  id            String              @id
  drawerId      String
  type          CashTransactionType
  amount        Decimal             @db.Decimal(12, 2)
  balanceBefore Decimal             @db.Decimal(12, 2)
  balanceAfter  Decimal             @db.Decimal(12, 2)
  referenceId   String?
  referenceType String?
  description   String?
  performedById String
  createdAt     DateTime            @default(now())
  CashDrawer    CashDrawer          @relation(fields: [drawerId], references: [id], onDelete: Cascade)
  User          User                @relation(fields: [performedById], references: [id])

  @@index([createdAt])
  @@index([drawerId])
  @@index([type])
}

model Category {
  id             String       @id
  organizationId String
  name           String
  slug           String
  description    String?
  parentId       String?
  imageUrl       String?
  sortOrder      Int          @default(0)
  isActive       Boolean      @default(true)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime
  Organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  Category       Category?    @relation("CategoryToCategory", fields: [parentId], references: [id])
  other_Category Category[]   @relation("CategoryToCategory")
  Product        Product[]

  @@unique([organizationId, slug])
  @@index([organizationId])
  @@index([parentId])
}

model CreditTransaction {
  id            String                @id
  customerId    String
  saleId        String?
  type          CreditTransactionType
  amount        Decimal               @db.Decimal(10, 2)
  balanceAfter  Decimal               @db.Decimal(10, 2)
  paymentMethod PaymentMethod?
  reference     String?
  dueDate       DateTime?
  notes         String?
  createdById   String
  createdAt     DateTime              @default(now())
  User          User                  @relation(fields: [createdById], references: [id])
  Customer      Customer              @relation(fields: [customerId], references: [id], onDelete: Cascade)
  Sale          Sale?                 @relation(fields: [saleId], references: [id])

  @@index([createdAt])
  @@index([customerId])
  @@index([saleId])
  @@index([type])
}

model Customer {
  id                String              @id
  organizationId    String
  code              String
  type              CustomerType        @default(INDIVIDUAL)
  name              String
  email             String?
  phone             String?
  address           String?
  city              String?
  country           String?
  taxId             String?
  creditLimit       Decimal             @default(0) @db.Decimal(10, 2)
  currentBalance    Decimal             @default(0) @db.Decimal(10, 2)
  creditStatus      CreditStatus        @default(GOOD)
  lastPaymentDate   DateTime?
  paymentTerms      String?
  notes             String?
  isActive          Boolean             @default(true)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  CreditTransaction CreditTransaction[]
  Organization      Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  Invoice           Invoice[]
  Return            Return[]
  Sale              Sale[]

  @@unique([organizationId, code])
  @@index([creditStatus])
  @@index([organizationId])
  @@index([type])
}

model Expense {
  id                              String                @id
  expenseNumber                   String                @unique
  categoryId                      String
  locationId                      String?
  supplierId                      String?
  amount                          Decimal               @db.Decimal(12, 2)
  currency                        String                @default("GHS")
  expenseDate                     DateTime
  paymentMethod                   PaymentMethod         @default(CASH)
  paymentStatus                   ExpensePaymentStatus  @default(PAID)
  description                     String?
  receiptUrl                      String?
  isRecurring                     Boolean               @default(false)
  recurringFrequency              RecurringFrequency?
  nextDueDate                     DateTime?
  approvalStatus                  ExpenseApprovalStatus @default(APPROVED)
  approvedById                    String?
  createdById                     String
  createdAt                       DateTime              @default(now())
  updatedAt                       DateTime
  User_Expense_approvedByIdToUser User?                 @relation("Expense_approvedByIdToUser", fields: [approvedById], references: [id])
  ExpenseCategory                 ExpenseCategory       @relation(fields: [categoryId], references: [id])
  User_Expense_createdByIdToUser  User                  @relation("Expense_createdByIdToUser", fields: [createdById], references: [id])
  Location                        Location?             @relation(fields: [locationId], references: [id])
  Supplier                        Supplier?             @relation(fields: [supplierId], references: [id])

  @@index([categoryId])
  @@index([expenseDate])
  @@index([paymentStatus])
}

model ExpenseCategory {
  id                    String            @id
  organizationId        String
  name                  String
  description           String?
  budgetAmount          Decimal?          @db.Decimal(12, 2)
  budgetPeriod          BudgetPeriod?
  parentId              String?
  isActive              Boolean           @default(true)
  createdAt             DateTime          @default(now())
  updatedAt             DateTime
  Expense               Expense[]
  Organization          Organization      @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  ExpenseCategory       ExpenseCategory?  @relation("ExpenseCategoryToExpenseCategory", fields: [parentId], references: [id])
  other_ExpenseCategory ExpenseCategory[] @relation("ExpenseCategoryToExpenseCategory")

  @@unique([organizationId, name])
  @@index([organizationId])
  @@index([parentId])
}

model Invitation {
  id              String           @id
  organizationId  String
  email           String
  roleId          String
  token           String           @unique
  status          InvitationStatus @default(PENDING)
  expiresAt       DateTime
  invitedById     String
  oneTimePasscode String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime
  User            User             @relation(fields: [invitedById], references: [id])
  Organization    Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  Role            Role             @relation(fields: [roleId], references: [id])

  @@unique([organizationId, email])
  @@index([organizationId])
}

model Invoice {
  id             String        @id
  invoiceNumber  String        @unique
  saleId         String
  customerId     String
  locationId     String
  status         InvoiceStatus @default(DRAFT)
  issueDate      DateTime      @default(now())
  dueDate        DateTime
  subtotal       Decimal       @db.Decimal(12, 2)
  taxAmount      Decimal       @default(0) @db.Decimal(10, 2)
  discountAmount Decimal       @default(0) @db.Decimal(10, 2)
  totalAmount    Decimal       @db.Decimal(12, 2)
  amountPaid     Decimal       @default(0) @db.Decimal(12, 2)
  balanceDue     Decimal       @db.Decimal(12, 2)
  paymentTerms   String?
  notes          String?
  pdfUrl         String?
  sentAt         DateTime?
  paidAt         DateTime?
  createdById    String
  createdAt      DateTime      @default(now())
  updatedAt      DateTime
  User           User          @relation(fields: [createdById], references: [id])
  Customer       Customer      @relation(fields: [customerId], references: [id])
  Location       Location      @relation(fields: [locationId], references: [id])
  Sale           Sale          @relation(fields: [saleId], references: [id])

  @@index([customerId])
  @@index([dueDate])
  @@index([saleId])
  @@index([status])
}

model InvoiceSettings {
  id             String       @id
  organizationId String       @unique
  prefix         String       @default("INV")
  nextNumber     Int          @default(1)
  defaultTerms   String?
  footerText     String?
  Organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
}

model Location {
  id                                                          String          @id
  organizationId                                              String
  name                                                        String
  type                                                        LocationType
  address                                                     String?
  city                                                        String?
  country                                                     String?
  phone                                                       String?
  email                                                       String?
  isActive                                                    Boolean         @default(true)
  parentLocationId                                            String?
  createdAt                                                   DateTime        @default(now())
  updatedAt                                                   DateTime
  CashDrawer                                                  CashDrawer[]
  Expense                                                     Expense[]
  Invoice                                                     Invoice[]
  Organization                                                Organization    @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  Location                                                    Location?       @relation("LocationToLocation", fields: [parentLocationId], references: [id])
  other_Location                                              Location[]      @relation("LocationToLocation")
  PurchaseOrder                                               PurchaseOrder[]
  Return                                                      Return[]
  Sale                                                        Sale[]
  StockAlert                                                  StockAlert[]
  StockLevel                                                  StockLevel[]
  StockTransfer_StockTransfer_destinationLocationIdToLocation StockTransfer[] @relation("StockTransfer_destinationLocationIdToLocation")
  StockTransfer_StockTransfer_sourceLocationIdToLocation      StockTransfer[] @relation("StockTransfer_sourceLocationIdToLocation")
  User                                                        User[]
  UserLocation                                                UserLocation[]

  @@index([isActive])
  @@index([organizationId])
  @@index([type])
}

model Organization {
  id                 String             @id
  name               String
  slug               String             @unique
  email              String
  phone              String?
  logo               String?
  address            String?
  city               String?
  country            String?
  currency           String             @default("GHS")
  timezone           String             @default("Africa/Accra")
  planId             String?
  planName           String             @default("trial")
  billingCycle       BillingCycle       @default(MONTHLY)
  trialEndsAt        DateTime?
  subscriptionEndsAt DateTime?
  subscriptionStatus SubscriptionStatus @default(TRIALING)
  maxLocations       Int                @default(1)
  maxProducts        Int                @default(100)
  maxUsers           Int                @default(2)
  maxStorageMb       Int                @default(1024)
  features           Json               @default("{}")
  isActive           Boolean            @default(true)
  createdAt          DateTime           @default(now())
  updatedAt          DateTime
  CashDrawer         CashDrawer[]
  Category           Category[]
  Customer           Customer[]
  ExpenseCategory    ExpenseCategory[]
  Invitation         Invitation[]
  InvoiceSettings    InvoiceSettings?
  Location           Location[]
  Plan               Plan?              @relation(fields: [planId], references: [id])
  Product            Product[]
  Role               Role[]
  Subscription       Subscription?
  Supplier           Supplier[]
  User               User[]

  @@index([slug])
  @@index([subscriptionStatus])
}

model Payment {
  id                    String        @id
  subscriptionId        String
  paystackReference     String        @unique
  paystackTransactionId String?
  amount                Decimal       @db.Decimal(10, 2)
  currency              String        @default("GHS")
  status                PaymentStatus
  paidAt                DateTime?
  invoiceNumber         String?
  receiptUrl            String?
  createdAt             DateTime      @default(now())
  Subscription          Subscription  @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([status])
}

model Plan {
  id                      String         @id
  name                    String         @unique
  displayName             String
  description             String?
  monthlyPrice            Decimal        @db.Decimal(10, 2)
  annualPrice             Decimal        @db.Decimal(10, 2)
  currency                String         @default("GHS")
  paystackMonthlyPlanCode String?
  paystackAnnualPlanCode  String?
  maxLocations            Int
  maxProducts             Int
  maxUsers                Int
  maxStorageMb            Int
  features                Json
  isActive                Boolean        @default(true)
  sortOrder               Int            @default(0)
  createdAt               DateTime       @default(now())
  updatedAt               DateTime
  Organization            Organization[]
}

model ProductVariant {
  id           String       @id
  productId    String
  name         String
  sku          String
  barcode      String?
  costPrice    Decimal      @db.Decimal(10, 2)
  sellingPrice Decimal      @db.Decimal(10, 2)
  imageUrl     String?
  attributes   Json
  isActive     Boolean      @default(true)
  sortOrder    Int          @default(0)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime
  Product      Product      @relation(fields: [productId], references: [id], onDelete: Cascade)
  ReturnItem   ReturnItem[]
  SaleItem     SaleItem[]

  @@index([productId])
}

model PurchaseOrder {
  id                String              @id
  poNumber          String              @unique
  supplierId        String
  locationId        String
  status            PurchaseOrderStatus @default(DRAFT)
  orderDate         DateTime            @default(now())
  expectedDate      DateTime?
  receivedDate      DateTime?
  subtotal          Decimal             @default(0) @db.Decimal(12, 2)
  taxAmount         Decimal             @default(0) @db.Decimal(10, 2)
  shippingCost      Decimal             @default(0) @db.Decimal(10, 2)
  totalAmount       Decimal             @default(0) @db.Decimal(12, 2)
  notes             String?
  createdById       String
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  User              User                @relation(fields: [createdById], references: [id])
  Location          Location            @relation(fields: [locationId], references: [id])
  Supplier          Supplier            @relation(fields: [supplierId], references: [id])
  PurchaseOrderItem PurchaseOrderItem[]
  ReceivingRecord   ReceivingRecord[]

  @@index([locationId])
  @@index([status])
  @@index([supplierId])
}

model PurchaseOrderItem {
  id               String        @id
  purchaseOrderId  String
  productId        String
  orderedQuantity  Decimal       @db.Decimal(10, 2)
  receivedQuantity Decimal       @default(0) @db.Decimal(10, 2)
  unitCost         Decimal       @db.Decimal(10, 2)
  expirationDate   DateTime?
  notes            String?
  Product          Product       @relation(fields: [productId], references: [id])
  PurchaseOrder    PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([purchaseOrderId])
}

model ReceivingRecord {
  id              String        @id
  purchaseOrderId String
  receivedById    String
  receivedAt      DateTime      @default(now())
  items           Json
  notes           String?
  PurchaseOrder   PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
  User            User          @relation(fields: [receivedById], references: [id])

  @@index([purchaseOrderId])
}

model Return {
  id                             String         @id
  returnNumber                   String         @unique
  saleId                         String
  customerId                     String?
  locationId                     String
  status                         ReturnStatus   @default(REQUESTED)
  returnType                     ReturnType     @default(REFUND)
  reason                         ReturnReason
  reasonNotes                    String?
  requestedAt                    DateTime       @default(now())
  approvedById                   String?
  approvedAt                     DateTime?
  receivedById                   String?
  receivedAt                     DateTime?
  inspectionNotes                String?
  refundAmount                   Decimal        @default(0) @db.Decimal(12, 2)
  refundMethod                   PaymentMethod?
  refundedAt                     DateTime?
  createdById                    String
  createdAt                      DateTime       @default(now())
  updatedAt                      DateTime
  User_Return_approvedByIdToUser User?          @relation("Return_approvedByIdToUser", fields: [approvedById], references: [id])
  User_Return_createdByIdToUser  User           @relation("Return_createdByIdToUser", fields: [createdById], references: [id])
  Customer                       Customer?      @relation(fields: [customerId], references: [id])
  Location                       Location       @relation(fields: [locationId], references: [id])
  User_Return_receivedByIdToUser User?          @relation("Return_receivedByIdToUser", fields: [receivedById], references: [id])
  Sale                           Sale           @relation(fields: [saleId], references: [id])
  ReturnItem                     ReturnItem[]

  @@index([locationId])
  @@index([saleId])
  @@index([status])
}

model ReturnItem {
  id                String          @id
  returnId          String
  saleItemId        String
  productId         String
  variantId         String?
  quantity          Decimal         @db.Decimal(10, 2)
  returnedQuantity  Decimal         @default(0) @db.Decimal(10, 2)
  condition         ItemCondition   @default(GOOD)
  disposition       ItemDisposition @default(RETURN_TO_STOCK)
  restockLocationId String?
  unitRefund        Decimal         @db.Decimal(10, 2)
  totalRefund       Decimal         @db.Decimal(12, 2)
  notes             String?
  Product           Product         @relation(fields: [productId], references: [id])
  Return            Return          @relation(fields: [returnId], references: [id], onDelete: Cascade)
  SaleItem          SaleItem        @relation(fields: [saleItemId], references: [id])
  ProductVariant    ProductVariant? @relation(fields: [variantId], references: [id])

  @@index([productId])
  @@index([returnId])
}

model Role {
  id             String        @id
  organizationId String?
  name           String
  description    String?
  permissions    Json
  isSystem       Boolean       @default(false)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime
  Invitation     Invitation[]
  Organization   Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  User           User[]

  @@unique([organizationId, name])
  @@index([organizationId])
}

model StockAlert {
  id                String      @id
  productId         String
  locationId        String
  alertType         AlertType
  currentQuantity   Decimal     @db.Decimal(10, 2)
  thresholdQuantity Decimal     @db.Decimal(10, 2)
  expirationDate    DateTime?
  status            AlertStatus @default(ACTIVE)
  snoozedUntil      DateTime?
  resolvedAt        DateTime?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime
  Location          Location    @relation(fields: [locationId], references: [id], onDelete: Cascade)
  Product           Product     @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([alertType])
  @@index([locationId])
  @@index([productId])
  @@index([status])
}

model StockLevel {
  id                String    @id
  productId         String
  locationId        String
  quantity          Decimal   @default(0) @db.Decimal(10, 2)
  reservedQuantity  Decimal   @default(0) @db.Decimal(10, 2)
  expirationDate    DateTime?
  manufacturingDate DateTime?
  lastCountedAt     DateTime?
  updatedAt         DateTime
  Location          Location  @relation(fields: [locationId], references: [id], onDelete: Cascade)
  Product           Product   @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, locationId, expirationDate])
  @@index([expirationDate])
  @@index([locationId])
  @@index([productId])
}

model StockTransfer {
  id                                                     String              @id
  transferNumber                                         String              @unique
  sourceLocationId                                       String
  destinationLocationId                                  String
  status                                                 TransferStatus      @default(DRAFT)
  requestedById                                          String
  approvedById                                           String?
  shippedAt                                              DateTime?
  receivedAt                                             DateTime?
  notes                                                  String?
  createdAt                                              DateTime            @default(now())
  updatedAt                                              DateTime
  User_StockTransfer_approvedByIdToUser                  User?               @relation("StockTransfer_approvedByIdToUser", fields: [approvedById], references: [id])
  Location_StockTransfer_destinationLocationIdToLocation Location            @relation("StockTransfer_destinationLocationIdToLocation", fields: [destinationLocationId], references: [id])
  User_StockTransfer_requestedByIdToUser                 User                @relation("StockTransfer_requestedByIdToUser", fields: [requestedById], references: [id])
  Location_StockTransfer_sourceLocationIdToLocation      Location            @relation("StockTransfer_sourceLocationIdToLocation", fields: [sourceLocationId], references: [id])
  StockTransferItem                                      StockTransferItem[]

  @@index([destinationLocationId])
  @@index([sourceLocationId])
  @@index([status])
}

model StockTransferItem {
  id                String        @id
  transferId        String
  productId         String
  requestedQuantity Decimal       @db.Decimal(10, 2)
  shippedQuantity   Decimal       @default(0) @db.Decimal(10, 2)
  receivedQuantity  Decimal       @default(0) @db.Decimal(10, 2)
  notes             String?
  Product           Product       @relation(fields: [productId], references: [id])
  StockTransfer     StockTransfer @relation(fields: [transferId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([transferId])
}

model Subscription {
  id                       String             @id
  organizationId           String             @unique
  paystackCustomerCode     String?
  paystackSubscriptionCode String?
  paystackPlanCode         String?
  paystackEmailToken       String?
  planId                   String
  planName                 String
  amount                   Decimal            @db.Decimal(10, 2)
  currency                 String             @default("GHS")
  billingCycle             BillingCycle
  status                   SubscriptionStatus
  currentPeriodStart       DateTime?
  currentPeriodEnd         DateTime?
  canceledAt               DateTime?
  cancelReason             String?
  createdAt                DateTime           @default(now())
  updatedAt                DateTime
  Payment                  Payment[]
  Organization             Organization       @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([status])
}

model Supplier {
  id              String            @id
  organizationId  String
  code            String
  name            String
  email           String?
  phone           String?
  address         String?
  city            String?
  country         String?
  website         String?
  taxId           String?
  paymentTerms    String?
  leadTimeDays    Int               @default(0)
  notes           String?
  isActive        Boolean           @default(true)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  Expense         Expense[]
  PurchaseOrder   PurchaseOrder[]
  Organization    Organization      @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  SupplierContact SupplierContact[]
  SupplierProduct SupplierProduct[]

  @@unique([organizationId, code])
  @@index([organizationId])
}

model SupplierContact {
  id         String   @id
  supplierId String
  name       String
  role       String?
  email      String?
  phone      String?
  isPrimary  Boolean  @default(false)
  notes      String?
  Supplier   Supplier @relation(fields: [supplierId], references: [id], onDelete: Cascade)

  @@index([supplierId])
}

model SupplierProduct {
  id              String   @id
  supplierId      String
  productId       String
  supplierSku     String?
  unitCost        Decimal  @db.Decimal(10, 2)
  leadTimeDays    Int      @default(0)
  minimumOrderQty Decimal  @default(1) @db.Decimal(10, 2)
  isPrimary       Boolean  @default(false)
  notes           String?
  Product         Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  Supplier        Supplier @relation(fields: [supplierId], references: [id], onDelete: Cascade)

  @@unique([supplierId, productId])
  @@index([productId])
  @@index([supplierId])
}

model User {
  id                                              String              @id
  organizationId                                  String
  email                                           String
  passwordHash                                    String
  name                                            String
  phone                                           String?
  roleId                                          String
  defaultLocationId                               String?
  isOwner                                         Boolean             @default(false)
  isActive                                        Boolean             @default(true)
  lastLoginAt                                     DateTime?
  createdAt                                       DateTime            @default(now())
  updatedAt                                       DateTime
  AuditLog                                        AuditLog[]
  CashDrawer_CashDrawer_closedByIdToUser          CashDrawer[]        @relation("CashDrawer_closedByIdToUser")
  CashDrawer_CashDrawer_openedByIdToUser          CashDrawer[]        @relation("CashDrawer_openedByIdToUser")
  CashTransaction                                 CashTransaction[]
  CreditTransaction                               CreditTransaction[]
  Expense_Expense_approvedByIdToUser              Expense[]           @relation("Expense_approvedByIdToUser")
  Expense_Expense_createdByIdToUser               Expense[]           @relation("Expense_createdByIdToUser")
  Invitation                                      Invitation[]
  Invoice                                         Invoice[]
  PurchaseOrder                                   PurchaseOrder[]
  ReceivingRecord                                 ReceivingRecord[]
  Return_Return_approvedByIdToUser                Return[]            @relation("Return_approvedByIdToUser")
  Return_Return_createdByIdToUser                 Return[]            @relation("Return_createdByIdToUser")
  Return_Return_receivedByIdToUser                Return[]            @relation("Return_receivedByIdToUser")
  Sale                                            Sale[]
  StockTransfer_StockTransfer_approvedByIdToUser  StockTransfer[]     @relation("StockTransfer_approvedByIdToUser")
  StockTransfer_StockTransfer_requestedByIdToUser StockTransfer[]     @relation("StockTransfer_requestedByIdToUser")
  Location                                        Location?           @relation(fields: [defaultLocationId], references: [id])
  Organization                                    Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  Role                                            Role                @relation(fields: [roleId], references: [id])
  UserLocation                                    UserLocation[]

  @@unique([organizationId, email])
  @@index([organizationId])
  @@index([roleId])
}

model UserLocation {
  id         String   @id
  userId     String
  locationId String
  assignedAt DateTime @default(now())
  Location   Location @relation(fields: [locationId], references: [id], onDelete: Cascade)
  User       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, locationId])
  @@index([locationId])
  @@index([userId])
}

enum AlertStatus {
  ACTIVE
  SNOOZED
  RESOLVED
}

enum AlertType {
  LOW_STOCK
  OUT_OF_STOCK
  OVERSTOCK
  EXPIRING_SOON
  EXPIRED
}

enum BillingCycle {
  MONTHLY
  ANNUALLY
}

enum BudgetPeriod {
  MONTHLY
  QUARTERLY
  YEARLY
}

enum CashDrawerStatus {
  CLOSED
  OPEN
  PAUSED
}

enum CashTransactionType {
  OPENING_FLOAT
  SALE_CASH_IN
  EXPENSE_CASH_OUT
  RETURN_REFUND
  SAFE_DROP
  PETTY_CASH_IN
  CLOSING_COUNT
}

enum CreditStatus {
  GOOD
  WARNING
  BLOCKED
}

enum CreditTransactionType {
  CREDIT
  PAYMENT
  ADJUSTMENT
}

enum CustomerType {
  INDIVIDUAL
  BUSINESS
}

enum ExpenseApprovalStatus {
  PENDING
  APPROVED
  REJECTED
}

enum ExpensePaymentStatus {
  PAID
  PENDING
  PARTIAL
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  EXPIRED
  REVOKED
}

enum InvoiceStatus {
  DRAFT
  SENT
  PAID
  OVERDUE
  CANCELLED
}

enum ItemCondition {
  NEW
  GOOD
  DAMAGED
  DEFECTIVE
}

enum ItemDisposition {
  RETURN_TO_STOCK
  QUARANTINE
  DISPOSE
  RETURN_TO_SUPPLIER
}

enum LocationType {
  WAREHOUSE
  STORE
  VIRTUAL
}

enum PaymentMethod {
  CASH
  CARD
  MOBILE_MONEY
  BANK_TRANSFER
  MULTIPLE
}

enum PaymentStatus {
  PENDING
  SUCCESS
  FAILED
  REFUNDED
}

enum ProductStatus {
  ACTIVE
  INACTIVE
  DISCONTINUED
}

enum PurchaseOrderStatus {
  DRAFT
  SENT
  PARTIAL
  RECEIVED
  CANCELLED
}

enum RecurringFrequency {
  WEEKLY
  MONTHLY
  QUARTERLY
  YEARLY
}

enum ReturnReason {
  DEFECTIVE
  WRONG_ITEM
  CHANGED_MIND
  DAMAGED
  EXPIRED
  OTHER
}

enum ReturnStatus {
  REQUESTED
  APPROVED
  RECEIVED
  INSPECTED
  PROCESSED
  REJECTED
}

enum ReturnType {
  REFUND
  EXCHANGE
  STORE_CREDIT
}

enum SalePaymentType {
  CASH
  CREDIT
  PARTIAL
}

enum SaleStatus {
  PENDING
  COMPLETED
  REFUNDED
  VOID
}

enum SubscriptionStatus {
  TRIALING
  ACTIVE
  PAST_DUE
  CANCELED
  EXPIRED
}

enum TransferStatus {
  DRAFT
  PENDING
  APPROVED
  IN_TRANSIT
  RECEIVED
  CANCELLED
}
